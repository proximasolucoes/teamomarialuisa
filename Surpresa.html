<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Caixa dos Sentimentos</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/howler@2.2.3/dist/howler.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body, html {
      height: 100%;
      width: 100%;
      font-family: 'Quicksand', sans-serif;
      background: linear-gradient(135deg, #0d1b2a 0%, #1e3a5f 50%, #2a5298 100%);
      overflow: hidden;
    }
    
    canvas {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 0;
      pointer-events: none;
    }
    
    .animated-bg {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 50%, rgba(255,255,255,0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255,255,255,0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 80%, rgba(255,255,255,0.1) 0%, transparent 50%);
      animation: float 20s ease-in-out infinite;
      opacity: 0.3;
      pointer-events: none;
      z-index: 1;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      33% { transform: translateY(-10px) rotate(1deg); }
      66% { transform: translateY(5px) rotate(-1deg); }
    }
    
    #welcomeMessage {
      position: absolute;
      top: 25vh;
      width: 100%;
      text-align: center;
      color: #fff;
      font-size: 1.4rem;
      font-weight: bold;
      text-shadow: 0 0 20px rgba(255,255,255,0.8);
      z-index: 10;
      animation: pulse 3s ease-in-out infinite;
      opacity: 1;
      transition: opacity 1s ease;
      user-select: none;
      padding: 0 20px;
    }
    
    @keyframes pulse {
      0%, 100% { transform: translateY(0); opacity: 1; }
      50% { transform: translateY(-10px); opacity: 0.8; }
    }
    
    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      z-index: 5;
      position: relative;
      padding: 20px;
    }
    
    .box {
      width: 160px;
      height: 160px;
      background: linear-gradient(45deg, rgba(255, 240, 246, 0.9), rgba(255, 255, 255, 0.9));
      border-radius: 20px;
      box-shadow: 
        0 0 30px rgba(255, 100, 150, 0.6),
        inset 0 0 20px rgba(255, 255, 255, 0.3);
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 80px;
      cursor: pointer;
      opacity: 0;
      transition: all 0.3s ease;
      border: 2px solid rgba(255, 255, 255, 0.3);
    }
    
    .box:hover, .box:focus {
      transform: scale(1.05);
      box-shadow: 
        0 0 40px rgba(255, 100, 150, 0.8),
        inset 0 0 25px rgba(255, 255, 255, 0.4);
    }
    
    .icon-menu {
      display: none;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin-top: 30px;
      animation: fadeInUp 0.8s ease;
    }
    
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .icon {
      width: 70px;
      height: 70px;
      background: linear-gradient(45deg, rgba(255,255,255,0.95), rgba(240,240,255,0.9));
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 32px;
      box-shadow: 
        0 8px 20px rgba(0,0,0,0.2),
        inset 0 0 15px rgba(255,255,255,0.3);
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid rgba(255, 255, 255, 0.4);
    }
    
    .icon:hover, .icon:focus {
      transform: scale(1.15) translateY(-5px);
      box-shadow: 
        0 12px 25px rgba(0,0,0,0.3),
        inset 0 0 20px rgba(255,255,255,0.4);
    }
    
    #letterBox, #thoughtBox, #imageBox, #surpriseBox {
      display: none;
      margin-top: 30px;
      padding: 20px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(250, 250, 255, 0.9));
      border-radius: 15px;
      box-shadow: 
        0 10px 30px rgba(0, 0, 0, 0.2),
        inset 0 0 20px rgba(255, 255, 255, 0.3);
      max-width: 450px;
      color: #333;
      white-space: pre-wrap;
      opacity: 0;
      transition: all 0.8s ease;
      border: 2px solid rgba(255, 255, 255, 0.3);
      backdrop-filter: blur(10px);
    }
    
    #thoughtBox {
      text-align: center;
      font-size: 1.1rem;
      line-height: 1.6;
    }
    
    #imageBox {
      text-align: center;
    }
    
    #imageBox img {
      max-width: 100%;
      border-radius: 12px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
      margin-bottom: 15px;
    }
    
    .image-caption {
      text-align: center;
      font-size: 1.2rem;
      color: #333;
      font-weight: 600;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    #imageBox.show, #letterBox.show, #thoughtBox.show, #surpriseBox.show {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }
    
    .back-button {
      margin-top: 20px;
      padding: 10px 20px;
      background: linear-gradient(45deg, rgba(255, 100, 150, 0.8), rgba(255, 150, 200, 0.8));
      color: white;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-family: 'Quicksand', sans-serif;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(255, 100, 150, 0.3);
    }
    
    .back-button:hover, .back-button:focus {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 100, 150, 0.4);
    }
    
    .typing-cursor {
      animation: blink 1s infinite;
    }
    
    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }
    
    /* Responsividade */
    @media (max-width: 768px) {
      .box {
        width: 130px;
        height: 130px;
        font-size: 65px;
      }
      
      .icon {
        width: 60px;
        height: 60px;
        font-size: 28px;
      }
      
      #welcomeMessage {
        font-size: 1.2rem;
        top: 20vh;
      }
      
      #letterBox, #thoughtBox, #imageBox, #surpriseBox {
        max-width: 90vw;
        padding: 15px;
      }
    }
    
    @media (max-width: 480px) {
      .box {
        width: 110px;
        height: 110px;
        font-size: 55px;
      }
      
      .icon {
        width: 55px;
        height: 55px;
        font-size: 24px;
      }
      
      #welcomeMessage {
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <canvas id="starfield" aria-hidden="true"></canvas>
  <div class="animated-bg" aria-hidden="true"></div>

  <div id="welcomeMessage">
    <div>‚ú® Clique no presente para come√ßar ‚ú®</div>
    <div style="font-size: 0.9em; margin-top: 10px; opacity: 0.8;">
      (Dica: Pressione F11 para tela cheia)
    </div>
  </div>

  <div class="container">
    <div class="box" id="giftBox" aria-label="Abrir presente" role="button" tabindex="0">üéÅ</div>
    
    <div class="icon-menu" id="iconMenu">
      <div class="icon" id="iconLetter" title="Carta de Amor" tabindex="0" role="button" aria-label="Ler carta de amor">üíå</div>
      <div class="icon" id="iconImage" title="Nossa Foto" tabindex="0" role="button" aria-label="Ver nossa foto">üñºÔ∏è</div>
      <div class="icon" id="iconThought" title="Pensamentos" tabindex="0" role="button" aria-label="Ler pensamentos especiais">üí≠</div>
      <div class="icon" id="iconSurprise" title="Surpresa Especial" tabindex="0" role="button" aria-label="Descobrir surpresa especial">‚ú®</div>
    </div>
    
    <div id="letterBox" aria-live="polite"></div>
    <div id="thoughtBox" aria-live="polite"></div>
    <div id="surpriseBox" aria-live="polite"></div>
    <div id="imageBox" aria-live="polite">
      <img src="./imagens/foto_1.jpg" alt="Nossa foto especial" onerror="this.style.display='none'; this.nextElementSibling.innerHTML='üíï Coloque nossa foto em: ./imagens/foto_1.jpg üíï';" />
      <div class="image-caption">
        <span>Voc√™ est√° aqui no meu cora√ß√£o</span> ‚ù§Ô∏è
      </div>
    </div>
    
    <button class="back-button" id="backButton" style="display: none;">‚Üê Voltar ao Menu</button>
  </div>

  <script>
    // Configura√ß√£o do canvas de estrelas
    const canvas = document.getElementById('starfield');
    const ctx = canvas.getContext('2d');
    
    const resizeCanvas = () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    };
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // Classe para as estrelas
    class Star {
      constructor() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.radius = Math.random() * 1.5 + 0.3;
        this.alpha = Math.random();
        this.alphaSpeed = (Math.random() * 0.02) + 0.005;
        this.alphaDirection = Math.random() < 0.5 ? 1 : -1;
        this.twinkleSpeed = Math.random() * 0.02 + 0.01;
      }
      
      update() {
        this.alpha += this.alphaSpeed * this.alphaDirection;
        if (this.alpha <= 0.1 || this.alpha >= 1) {
          this.alphaDirection *= -1;
        }
      }
      
      draw(ctx) {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(255, 255, 255, ${this.alpha})`;
        ctx.shadowColor = ctx.fillStyle;
        ctx.shadowBlur = 6;
        ctx.fill();
        ctx.shadowBlur = 0;
      }
    }

    // Criar estrelas (menos em dispositivos m√≥veis)
    const starCount = window.innerWidth < 768 ? 100 : 180;
    const stars = Array.from({ length: starCount }, () => new Star());
    
    function animateStars() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      stars.forEach(star => {
        star.update();
        star.draw(ctx);
      });
      requestAnimationFrame(animateStars);
    }
    animateStars();

    // Elementos DOM
    const welcomeMessage = document.getElementById('welcomeMessage');
    const giftBox = document.getElementById('giftBox');
    const iconMenu = document.getElementById('iconMenu');
    const iconLetter = document.getElementById('iconLetter');
    const iconImage = document.getElementById('iconImage');
    const iconThought = document.getElementById('iconThought');
    const iconSurprise = document.getElementById('iconSurprise');
    const letterBox = document.getElementById('letterBox');
    const thoughtBox = document.getElementById('thoughtBox');
    const imageBox = document.getElementById('imageBox');
    const surpriseBox = document.getElementById('surpriseBox');
    const backButton = document.getElementById('backButton');

    // Sons com fallback
    let soundTyping, soundOpen, soundClick;
    try {
      soundTyping = new Howl({ 
        src: ['https://www.soundjay.com/misc/beep-07a.mp3'], 
        volume: 0.1,
        onloaderror: () => console.log('Som de digita√ß√£o n√£o carregou')
      });
      soundOpen = new Howl({ 
        src: ['https://www.soundjay.com/misc/bell-ringing-05.mp3'], 
        volume: 0.6,
        onloaderror: () => console.log('Som de abertura n√£o carregou')
      });
      soundClick = new Howl({ 
        src: ['https://www.soundjay.com/misc/click-01.mp3'], 
        volume: 0.4,
        onloaderror: () => console.log('Som de click n√£o carregou')
      });
    } catch (e) {
      console.log('Howler.js n√£o carregou, sons desabilitados');
    }

    // Textos
    const letterText = `Oi, meu amor...

Hoje √© Dia dos Namorados, e eu quis te escrever uma carta especial.

Espero que voc√™ goste dessa pequena surpresa que preparei com todo carinho. Eu queria um jeito diferente e √∫nico de te mostrar o quanto voc√™ √© especial para mim.

Voc√™ me encanta nos pequenos detalhes... na calma que voc√™ transmite, na forma doce como fala, no brilho do seu olhar quando sorri...

Voc√™ √© a minha poesia favorita, a m√∫sica mais linda que meu cora√ß√£o j√° ouviu.

Obrigado(a) por existir e por fazer parte da minha vida.

Com todo meu amor üíñ`;

    const thoughts = [
      "Voc√™ √© como uma estrela brilhante em meio √† escurid√£o do universo... üåü",
      "S√≥ de pensar em voc√™, meu cora√ß√£o se enche de alegria e sorri... üòä",
      "Tem algo m√°gico em voc√™ que acalma todas as tempestades aqui dentro... üåä",
      "Voc√™ √© o meu lugar favorito no mundo, mesmo quando estamos distantes... üè†",
      "Cada dia ao seu lado √© um presente que eu nunca vou cansar de desembrulhar... üéÅ"
    ];
    
    const surpriseText = `üéä SURPRESA ESPECIAL üéä

Voc√™ sabia que desde que voc√™ chegou na minha vida, tudo ficou mais colorido?

Que antes de voc√™, eu nem sabia que existia uma felicidade t√£o grande assim?

Que voc√™ √© a resposta para perguntas que eu nem sabia que tinha?

Voc√™ √© o meu "para sempre" favorito.

E essa √© s√≥ uma das muitas surpresas que ainda tenho guardadas para voc√™... 

Porque com voc√™, todos os dias s√£o especiais! ‚ú®üíï`;

    // Configura√ß√µes de digita√ß√£o
    const typingSpeed = 50;
    const delay = ms => new Promise(res => setTimeout(res, ms));
    
    // Vari√°vel para controlar a anima√ß√£o de digita√ß√£o
    let currentTypingAnimation = null;

    // Fun√ß√£o de digita√ß√£o melhorada com controle de cancelamento
    async function typeText(element, text, showCursor = true) {
      // Cancelar anima√ß√£o anterior se existir
      if (currentTypingAnimation) {
        currentTypingAnimation.cancelled = true;
      }
      
      // Criar nova anima√ß√£o
      const animation = { cancelled: false };
      currentTypingAnimation = animation;
      
      element.innerHTML = '';
      
      for (let i = 0; i < text.length; i++) {
        // Verificar se a anima√ß√£o foi cancelada
        if (animation.cancelled) {
          return;
        }
        
        element.innerHTML = text.substring(0, i + 1) + (showCursor ? '<span class="typing-cursor">|</span>' : '');
        
        if (soundTyping && Math.random() > 0.7) {
          try { soundTyping.play(); } catch (e) {}
        }
        
        await delay(typingSpeed + Math.random() * 30);
      }
      
      // Verificar se a anima√ß√£o foi cancelada antes de finalizar
      if (!animation.cancelled && showCursor) {
        await delay(500);
        if (!animation.cancelled) {
          element.innerHTML = text;
        }
      }
      
      // Limpar refer√™ncia se esta foi a √∫ltima anima√ß√£o
      if (currentTypingAnimation === animation) {
        currentTypingAnimation = null;
      }
    }

    // Fun√ß√£o para mostrar a caixa automaticamente
    function showGiftAutomatically() {
      setTimeout(() => {
        if (welcomeMessage.style.opacity !== '0') {
          welcomeMessage.style.opacity = '0';
          setTimeout(() => {
            welcomeMessage.style.display = 'none';
            giftBox.style.display = 'flex';
            setTimeout(() => {
              giftBox.style.opacity = '1';
            }, 100);
          }, 1000);
        }
      }, 8000); // Mostra automaticamente ap√≥s 8 segundos
    }

    // Fun√ß√£o para esconder todas as caixas
    function hideAllBoxes() {
      // Cancelar qualquer anima√ß√£o de digita√ß√£o em andamento
      if (currentTypingAnimation) {
        currentTypingAnimation.cancelled = true;
        currentTypingAnimation = null;
      }
      
      letterBox.classList.remove('show');
      thoughtBox.classList.remove('show');
      imageBox.classList.remove('show');
      surpriseBox.classList.remove('show');
      backButton.style.display = 'none';
    }

    // Fun√ß√£o para mostrar bot√£o de voltar
    function showBackButton() {
      backButton.style.display = 'block';
    }

    // Event listeners para teclado
    function addKeyboardSupport(element, callback) {
      element.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          callback();
        }
      });
    }

    // Inicializa√ß√£o
    window.addEventListener('load', () => {
      showGiftAutomatically();
    });

    // F11 para tela cheia
    window.addEventListener('keydown', async (e) => {
      if (e.key === 'F11') {
        e.preventDefault();
        if (welcomeMessage.style.opacity !== '0') {
          welcomeMessage.style.opacity = '0';
          await delay(1000);
          welcomeMessage.style.display = 'none';
          giftBox.style.display = 'flex';
          await delay(100);
          giftBox.style.opacity = '1';
        }
      }
    });

    // Abrir presente
    function openGift() {
      if (soundOpen) {
        try { soundOpen.play(); } catch (e) {}
      }
      giftBox.style.transform = 'scale(1.2)';
      giftBox.style.opacity = '0';
      setTimeout(() => {
        giftBox.style.display = 'none';
        iconMenu.style.display = 'flex';
      }, 300);
    }

    giftBox.addEventListener('click', openGift);
    addKeyboardSupport(giftBox, openGift);

    // Carta
    async function showLetter() {
      if (soundClick) {
        try { soundClick.play(); } catch (e) {}
      }
      hideAllBoxes();
      letterBox.innerHTML = '';
      letterBox.classList.add('show');
      showBackButton();
      await delay(100);
      await typeText(letterBox, letterText);
    }

    iconLetter.addEventListener('click', showLetter);
    addKeyboardSupport(iconLetter, showLetter);

    // Pensamentos
    async function showThoughts() {
      if (soundClick) {
        try { soundClick.play(); } catch (e) {}
      }
      hideAllBoxes();
      thoughtBox.classList.add('show');
      showBackButton();
      
      // Adicionar barra de progresso
      thoughtBox.innerHTML = `
        <div id="thoughtContent" style="min-height: 60px; margin-bottom: 15px;"></div>
        <div id="progressContainer" style="width: 100%; height: 4px; background: rgba(0,0,0,0.1); border-radius: 2px; overflow: hidden;">
          <div id="progressBar" style="height: 100%; background: linear-gradient(90deg, #4CAF50, #8BC34A); width: 0%; border-radius: 2px;"></div>
        </div>
      `;
      
      const thoughtContent = document.getElementById('thoughtContent');
      const progressBar = document.getElementById('progressBar');
      
      for (let i = 0; i < thoughts.length; i++) {
        // Verificar se a anima√ß√£o foi cancelada
        if (currentTypingAnimation && currentTypingAnimation.cancelled) {
          return;
        }
        
        // Mostrar pensamento
        thoughtContent.innerHTML = thoughts[i];
        thoughtContent.style.opacity = '0';
        thoughtContent.style.transform = 'translateY(20px)';
        
        // Anima√ß√£o de entrada
        await delay(100);
        thoughtContent.style.transition = 'all 0.8s ease';
        thoughtContent.style.opacity = '1';
        thoughtContent.style.transform = 'translateY(0)';
        
        // Resetar e animar barra de progresso
        progressBar.style.transition = 'none';
        progressBar.style.width = '0%';
        await delay(50);
        progressBar.style.transition = 'width 3s linear';
        progressBar.style.width = '100%';
        
        // Aguardar 3 segundos
        await delay(3000);
        
        // Verificar novamente se foi cancelada
        if (currentTypingAnimation && currentTypingAnimation.cancelled) {
          return;
        }
        
        // Anima√ß√£o de sa√≠da (exceto no √∫ltimo)
        if (i < thoughts.length - 1) {
          thoughtContent.style.transition = 'all 0.6s ease';
          thoughtContent.style.opacity = '0';
          thoughtContent.style.transform = 'translateY(-20px)';
          await delay(600);
        }
      }
      
      // Remover barra de progresso no final
      await delay(1000);
      const progressContainer = document.getElementById('progressContainer');
      if (progressContainer) {
        progressContainer.style.opacity = '0';
      }
    }

    iconThought.addEventListener('click', showThoughts);
    addKeyboardSupport(iconThought, showThoughts);

    // Imagem
    function showImage() {
      if (soundClick) {
        try { soundClick.play(); } catch (e) {}
      }
      hideAllBoxes();
      imageBox.classList.add('show');
      showBackButton();
    }

    iconImage.addEventListener('click', showImage);
    addKeyboardSupport(iconImage, showImage);

    // Surpresa
    async function showSurprise() {
      if (soundClick) {
        try { soundClick.play(); } catch (e) {}
      }
      hideAllBoxes();
      surpriseBox.classList.add('show');
      showBackButton();
      await delay(100);
      await typeText(surpriseBox, surpriseText);
    }

    iconSurprise.addEventListener('click', showSurprise);
    addKeyboardSupport(iconSurprise, showSurprise);

    // Bot√£o voltar
    function goBack() {
      hideAllBoxes();
      iconMenu.style.display = 'flex';
    }

    backButton.addEventListener('click', goBack);
    addKeyboardSupport(backButton, goBack);

    // Atalho ESC para voltar
    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && backButton.style.display === 'block') {
        goBack();
      }
    });
  </script>
</body>
</html>